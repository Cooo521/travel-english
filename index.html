<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel English Audio Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; touch-action: manipulation; }
        .wake-lock-active { color: #10b981; }
        .wake-lock-inactive { color: #ef4444; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">

    <!-- Blackout Curtain (Pocket Mode) -->
    <div id="curtain" class="fixed inset-0 bg-black z-50 hidden flex flex-col items-center justify-center cursor-pointer" onclick="toggleCurtain(false)">
        <div class="text-gray-500 text-sm animate-pulse select-none pointer-events-none mb-4">
            <i class="fas fa-moon mr-2"></i>再生中... (画面タップで復帰)
        </div>
        <div class="text-xs text-gray-800 select-none">System is active.</div>
    </div>

    <!-- Header & Status -->
    <header class="w-full max-w-md flex justify-between items-center mb-4">
        <h1 class="text-xl font-bold text-blue-400"><i class="fas fa-headphones mr-2"></i>Travel English</h1>
        <div class="text-xs text-gray-400 flex flex-col items-end">
            <span id="wakeLockStatus" class="wake-lock-inactive"><i class="fas fa-lightbulb mr-1"></i>画面維持: OFF</span>
        </div>
    </header>

    <!-- Course Selection -->
    <div class="w-full max-w-md mb-6 bg-gray-800 p-2 rounded-lg flex items-center justify-between">
        <label class="text-sm text-gray-300 font-bold ml-2">コース:</label>
        <select id="partSelector" onchange="changePart()" class="bg-gray-700 text-white text-sm rounded-md p-2 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 block w-2/3">
            <option value="part1">パート1：基本の200</option>
            <option value="part2">パート2：応用の200</option>
        </select>
    </div>

    <!-- Main Card -->
    <main class="w-full max-w-md flex-grow flex flex-col justify-center">
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-4">
            <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
        </div>
        <div class="text-center text-sm text-gray-400 mb-6">
            <span id="courseNameDisplay" class="font-bold text-blue-300 mr-2">Part 1</span>
            Phrase: <span id="currentIndex">1</span> / <span id="totalCount">200</span>
        </div>

        <!-- Phrase Card -->
        <div id="card" class="bg-gray-800 p-8 rounded-2xl border-2 border-gray-700 flex flex-col items-center justify-center min-h-[300px] transition-all duration-300 relative">
            <div id="japaneseText" class="text-xl md:text-2xl font-bold mb-8 text-center text-white leading-relaxed">
                再生ボタンを押して開始
            </div>
            
            <!-- Hidden/Revealed English Answer -->
            <div id="englishArea" class="opacity-0 transition-opacity duration-500 text-center w-full">
                <div id="englishText" class="text-lg md:text-xl text-yellow-400 font-medium mb-2 leading-relaxed break-words">
                    Ready?
                </div>
            </div>

            <!-- Auto Play Indicator -->
            <div id="statusIndicator" class="absolute bottom-4 right-4 text-xs text-gray-500">
                <i class="fas fa-forward mr-1"></i>Auto
            </div>
        </div>

        <!-- Controls -->
        <div class="mt-8 grid grid-cols-2 gap-4 w-full">
            <button id="toggleBtn" onclick="togglePlay()" class="col-span-2 bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition-transform active:scale-95">
                <i class="fas fa-play mr-2"></i>再生スタート
            </button>

            <!-- Pocket Mode -->
            <button onclick="toggleCurtain(true)" class="col-span-2 bg-gray-800 hover:bg-gray-700 text-gray-300 py-3 rounded-lg font-semibold border border-gray-600 active:scale-95 flex justify-center items-center">
                <i class="fas fa-moon mr-2"></i>画面を暗くする (ポケットモード)
            </button>

            <!-- Manual Navigation -->
            <button onclick="skip(-1)" class="bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold active:scale-95">
                <i class="fas fa-backward mr-2"></i>戻る
            </button>
            <button onclick="skip(1)" class="bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold active:scale-95">
                進む<i class="fas fa-forward ml-2"></i>
            </button>
        </div>

    </main>

    <script>
        // --- Data: Part 1 (Basic 200) ---
        const rawPhrasesPart1 = [
            { ja: "チェックインをお願いします。", en: "Check-in, please." },
            { ja: "予約しています。", en: "I have a reservation." },
            { ja: "パスポートを見せてください。", en: "Show me your passport, please." },
            { ja: "私の部屋はどこですか？", en: "Where is my room?" },
            { ja: "朝食は何時ですか？", en: "What time is breakfast?" },
            { ja: "Wi-Fiのパスワードは何ですか？", en: "What is the Wi-Fi password?" },
            { ja: "荷物を預かってもらえますか？", en: "Can you keep my baggage?" },
            { ja: "タクシーを呼んでもらえますか？", en: "Can you call a taxi for me?" },
            { ja: "近くにお勧めのレストランはありますか？", en: "Are there any recommended restaurants nearby?" },
            { ja: "チェックアウトをお願いします。", en: "Check-out, please." },
            { ja: "メニューを見せてください。", en: "Can I see the menu, please?" },
            { ja: "これをください。", en: "I'll have this." },
            { ja: "水をお願いします。", en: "Water, please." },
            { ja: "お会計をお願いします。", en: "Check, please." },
            { ja: "クレジットカードは使えますか？", en: "Do you accept credit cards?" },
            { ja: "トイレはどこですか？", en: "Where is the restroom?" },
            { ja: "このバスは市内に行きますか？", en: "Does this bus go to the city center?" },
            { ja: "ここで降ろしてください。", en: "Let me off here, please." },
            { ja: "地図をもらえますか？", en: "Can I have a map?" },
            { ja: "写真を撮ってもらえますか？", en: "Can you take a picture of me?" },
            { ja: "助けてください！", en: "Help!" },
            { ja: "日本語を話せる人はいますか？", en: "Is there anyone who speaks Japanese?" },
            { ja: "気分が悪いです。", en: "I feel sick." },
            { ja: "病院はどこですか？", en: "Where is the hospital?" },
            { ja: "いくらですか？", en: "How much is it?" },
            { ja: "高すぎます。", en: "It's too expensive." },
            { ja: "安くしてもらえませんか？", en: "Can you give me a discount?" },
            { ja: "試着してもいいですか？", en: "Can I try it on?" },
            { ja: "これの別の色はありますか？", en: "Do you have this in another color?" },
            { ja: "ただ見ているだけです。", en: "I'm just looking." },
            { ja: "搭乗口はどこですか？", en: "Where is the boarding gate?" },
            { ja: "乗り継ぎカウンターはどこですか？", en: "Where is the connecting flight counter?" },
            { ja: "荷物が出てきません。", en: "My baggage hasn't come out." },
            { ja: "両替所はどこですか？", en: "Where is the currency exchange?" },
            { ja: "地下鉄の駅はどこですか？", en: "Where is the subway station?" },
            { ja: "切符売り場はどこですか？", en: "Where is the ticket office?" },
            { ja: "この席は空いていますか？", en: "Is this seat taken?" },
            { ja: "少しゆっくり話してください。", en: "Please speak a little slower." },
            { ja: "もう一度言ってください。", en: "Could you say that again?" },
            { ja: "書いてもらえますか？", en: "Could you write it down?" },
            { ja: "意味がわかりません。", en: "I don't understand." },
            { ja: "結構です（断り）。", en: "No, thank you." },
            { ja: "はい、お願いします。", en: "Yes, please." },
            { ja: "すみません（呼びかけ）。", en: "Excuse me." },
            { ja: "ごめんなさい。", en: "I'm sorry." },
            { ja: "どういたしまして。", en: "You're welcome." },
            { ja: "楽しい時間を過ごしました。", en: "I had a great time." },
            { ja: "また会いましょう。", en: "See you again." },
            { ja: "持ち帰りにできますか？", en: "Can I have it to go?" },
            { ja: "お釣りはいりません。", en: "Keep the change." },
            { ja: "領収書をください。", en: "Receipt, please." },
            { ja: "予約していません。", en: "I don't have a reservation." },
            { ja: "窓側の席がいいです。", en: "I'd like a window seat." },
            { ja: "通路側の席がいいです。", en: "I'd like an aisle seat." },
            { ja: "禁煙席をお願いします。", en: "Non-smoking table, please." },
            { ja: "アレルギーがあります。", en: "I have an allergy." },
            { ja: "ナッツ抜きにできますか？", en: "Can you make it without nuts?" },
            { ja: "おすすめは何ですか？", en: "What do you recommend?" },
            { ja: "どのくらい待ちますか？", en: "How long is the wait?" },
            { ja: "もう注文しました。", en: "We've already ordered." },
            { ja: "まだ食べています。", en: "I'm still eating." },
            { ja: "お皿を下げてもらえますか？", en: "Can you clear the table?" },
            { ja: "別々に払えますか？", en: "Can we pay separately?" },
            { ja: "コンビニはどこですか？", en: "Where is a convenience store?" },
            { ja: "ATMはどこですか？", en: "Where is an ATM?" },
            { ja: "一番近い駅はどこですか？", en: "Where is the nearest station?" },
            { ja: "ここに行きたいのですが。", en: "I'd like to go here." },
            { ja: "歩いて行けますか？", en: "Can I walk there?" },
            { ja: "どのくらい時間がかかりますか？", en: "How long does it take?" },
            { ja: "右に曲がってください。", en: "Turn right." },
            { ja: "左に曲がってください。", en: "Turn left." },
            { ja: "まっすぐ行ってください。", en: "Go straight." },
            { ja: "角を曲がったところにあります。", en: "It's around the corner." },
            { ja: "迷子になりました。", en: "I'm lost." },
            { ja: "警察を呼んでください。", en: "Call the police." },
            { ja: "救急車を呼んでください。", en: "Call an ambulance." },
            { ja: "財布を盗まれました。", en: "My wallet was stolen." },
            { ja: "パスポートをなくしました。", en: "I lost my passport." },
            { ja: "大使館はどこですか？", en: "Where is the embassy?" },
            { ja: "電話を貸してもらえますか？", en: "Can I use your phone?" },
            { ja: "シャワーのお湯が出ません。", en: "There is no hot water in the shower." },
            { ja: "エアコンが動きません。", en: "The air conditioner doesn't work." },
            { ja: "隣の部屋がうるさいです。", en: "The room next door is noisy." },
            { ja: "タオルを交換してください。", en: "Please change the towels." },
            { ja: "部屋を掃除してください。", en: "Please clean my room." },
            { ja: "起こさないでください。", en: "Do not disturb." },
            { ja: "鍵を部屋に忘れました。", en: "I left my key in the room." },
            { ja: "アイロンを貸してもらえますか？", en: "Can I borrow an iron?" },
            { ja: "ドライヤーはありますか？", en: "Do you have a hair dryer?" },
            { ja: "タクシー乗り場はどこですか？", en: "Where is the taxi stand?" },
            { ja: "トランクを開けてください。", en: "Open the trunk, please." },
            { ja: "ここで待っていてください。", en: "Please wait here." },
            { ja: "急いでください。", en: "Please hurry." },
            { ja: "空港までお願いします。", en: "To the airport, please." },
            { ja: "お釣りは取っておいてください。", en: "Keep the change." },
            { ja: "免税になりますか？", en: "Is this duty-free?" },
            { ja: "袋をください。", en: "Can I have a bag?" },
            { ja: "ギフトラッピングをお願いします。", en: "Gift wrap, please." },
            { ja: "大きいサイズはありますか？", en: "Do you have a larger size?" },
            { ja: "小さいサイズはありますか？", en: "Do you have a smaller size?" },
            { ja: "日本円で払えますか？", en: "Can I pay in Japanese Yen?" },
            { ja: "両替レートはいくらですか？", en: "What is the exchange rate?" },
            { ja: "小銭を混ぜてくれますか？", en: "Can you include some small change?" },
            { ja: "美術館は何時に開きますか？", en: "What time does the museum open?" },
            { ja: "閉館時間はいつですか？", en: "When is the closing time?" },
            { ja: "入場料はいくらですか？", en: "How much is the admission fee?" },
            { ja: "学生割引はありますか？", en: "Is there a student discount?" },
            { ja: "写真を撮ってもいいですか？", en: "Can I take pictures?" },
            { ja: "フラッシュは禁止です。", en: "No flash allowed." },
            { ja: "ガイドツアーはありますか？", en: "Are there guided tours?" },
            { ja: "日本語のパンフレットはありますか？", en: "Do you have a Japanese brochure?" },
            { ja: "出口はどこですか？", en: "Where is the exit?" },
            { ja: "入り口はどこですか？", en: "Where is the entrance?" },
            { ja: "エレベーターはどこですか？", en: "Where is the elevator?" },
            { ja: "エスカレーターはどこですか？", en: "Where is the escalator?" },
            { ja: "喫煙所はどこですか？", en: "Where is the smoking area?" },
            { ja: "飲み水をくれませんか？", en: "Can I have some drinking water?" },
            { ja: "氷なしでお願いします。", en: "No ice, please." },
            { ja: "塩をください。", en: "Salt, please." },
            { ja: "砂糖をください。", en: "Sugar, please." },
            { ja: "フォークを落としました。", en: "I dropped my fork." },
            { ja: "新しいものを持ってきてください。", en: "Please bring me a new one." },
            { ja: "とても美味しかったです。", en: "It was delicious." },
            { ja: "満席です。", en: "We are full." },
            { ja: "何名様ですか？", en: "How many people?" },
            { ja: "2人です。", en: "Two people." },
            { ja: "4人です。", en: "Four people." },
            { ja: "子供用の椅子はありますか？", en: "Do you have a high chair?" },
            { ja: "ベジタリアン料理はありますか？", en: "Do you have vegetarian dishes?" },
            { ja: "豚肉は入っていますか？", en: "Does this contain pork?" },
            { ja: "牛肉は食べられません。", en: "I cannot eat beef." },
            { ja: "生ビールをください。", en: "Draft beer, please." },
            { ja: "グラスワインをください。", en: "A glass of wine, please." },
            { ja: "乾杯！", en: "Cheers!" },
            { ja: "お腹がいっぱいです。", en: "I'm full." },
            { ja: "これは何ですか？", en: "What is this?" },
            { ja: "辛いですか？", en: "Is it spicy?" },
            { ja: "甘いですか？", en: "Is it sweet?" },
            { ja: "酸っぱいですか？", en: "Is it sour?" },
            { ja: "苦いですか？", en: "Is it bitter?" },
            { ja: "熱いです。", en: "It's hot." },
            { ja: "冷たいです。", en: "It's cold." },
            { ja: "いつ出発しますか？", en: "When does it leave?" },
            { ja: "いつ到着しますか？", en: "When does it arrive?" },
            { ja: "遅れています。", en: "It's delayed." },
            { ja: "キャンセルされました。", en: "It's cancelled." },
            { ja: "どのホームですか？", en: "Which platform?" },
            { ja: "往復切符をください。", en: "Round trip ticket, please." },
            { ja: "片道切符をください。", en: "One way ticket, please." },
            { ja: "指定席をお願いします。", en: "Reserved seat, please." },
            { ja: "自由席でいいです。", en: "Non-reserved seat is fine." },
            { ja: "この電車は〇〇に止まりますか？", en: "Does this train stop at OO?" },
            { ja: "次の駅は何ですか？", en: "What is the next station?" },
            { ja: "乗り換えが必要です。", en: "You need to transfer." },
            { ja: "どこで乗り換えですか？", en: "Where do I transfer?" },
            { ja: "ドアが閉まります。", en: "Doors closing." },
            { ja: "ご注意ください。", en: "Please be careful." },
            { ja: "忘れ物をしました。", en: "I left something behind." },
            { ja: "落とし物センターはどこですか？", en: "Where is the lost and found?" },
            { ja: "名前は何ですか？", en: "What is your name?" },
            { ja: "日本から来ました。", en: "I'm from Japan." },
            { ja: "初めてここに来ました。", en: "This is my first time here." },
            { ja: "一人旅です。", en: "I'm traveling alone." },
            { ja: "家族と一緒です。", en: "I'm with my family." },
            { ja: "友達と一緒です。", en: "I'm with my friends." },
            { ja: "ここに住んでいますか？", en: "Do you live here?" },
            { ja: "お仕事は何ですか？", en: "What do you do?" },
            { ja: "趣味は何ですか？", en: "What is your hobby?" },
            { ja: "Facebookをやっていますか？", en: "Are you on Facebook?" },
            { ja: "Instagramをやっていますか？", en: "Are you on Instagram?" },
            { ja: "連絡先を教えてもらえますか？", en: "Can I have your contact info?" },
            { ja: "英語は少ししか話せません。", en: "I only speak a little English." },
            { ja: "もっと勉強します。", en: "I will study more." },
            { ja: "良い旅を！", en: "Have a nice trip!" },
            { ja: "気をつけて。", en: "Take care." },
            { ja: "お大事に。", en: "Get well soon." },
            { ja: "おめでとう。", en: "Congratulations." },
            { ja: "残念ですね。", en: "That's too bad." },
            { ja: "すごい！", en: "Amazing!" },
            { ja: "本当ですか？", en: "Really?" },
            { ja: "冗談でしょう？", en: "You're kidding!" },
            { ja: "もちろん。", en: "Of course." },
            { ja: "多分。", en: "Maybe." },
            { ja: "わかりました。", en: "I see." },
            { ja: "問題ありません。", en: "No problem." },
            { ja: "気にしないでください。", en: "Don't worry about it." },
            { ja: "手伝いましょうか？", en: "Can I help you?" },
            { ja: "良い天気ですね。", en: "It's nice weather." },
            { ja: "雨が降っています。", en: "It's raining." },
            { ja: "寒いです。", en: "It's cold." },
            { ja: "暑いです。", en: "It's hot." },
            { ja: "雪が降っています。", en: "It's snowing." },
            { ja: "傘を持っていません。", en: "I don't have an umbrella." },
            { ja: "濡れました。", en: "I got wet." },
            { ja: "乾かしたいです。", en: "I want to dry this." },
            { ja: "洗濯機はありますか？", en: "Is there a washing machine?" },
            { ja: "洗剤はありますか？", en: "Do you have detergent?" },
            { ja: "コインランドリーを探しています。", en: "I'm looking for a laundromat." }
        ];

        // --- Data: Part 2 (Advanced 200) ---
        const rawPhrasesPart2 = [
            { ja: "オンラインチェックインは済ませています。", en: "I've already checked in online." },
            { ja: "もっと早い便に変更できますか？", en: "Could I change to an earlier flight?" },
            { ja: "壊れ物が入っています。", en: "There are fragile items inside." },
            { ja: "座席をリクライニングしてもいいですか？", en: "Do you mind if I recline my seat?" },
            { ja: "入国カードの書き方がわかりません。", en: "I don't know how to fill out the arrival card." },
            { ja: "滞在目的は観光です。", en: "I'm here for sightseeing." },
            { ja: "5日間滞在する予定です。", en: "I plan to stay for 5 days." },
            { ja: "これが帰りのチケットです。", en: "This is my return ticket." },
            { ja: "荷物が出てきません。確認してもらえますか？", en: "My luggage hasn't come out. Could you check?" },
            { ja: "スーツケースのキャスターが壊れています。", en: "The wheel on my suitcase is broken." },
            { ja: "乗り継ぎ時間が1時間しかありません。", en: "I only have a one-hour layover." },
            { ja: "市内への一番早い行き方は何ですか？", en: "What's the fastest way to the city?" },
            { ja: "シャトルバス乗り場はどこですか？", en: "Where is the shuttle bus stop?" },
            { ja: "この住所へ行きたいのですが。", en: "I'd like to go to this address." },
            { ja: "トランクに荷物を入れてもらえますか？", en: "Could you put my bags in the trunk?" },
            { ja: "そこまでどのくらいかかりますか？", en: "How long will it take to get there?" },
            { ja: "ここで降ろしてください。残りは歩きます。", en: "Please drop me here. I'll walk the rest." },
            { ja: "メーターを動かしてください。", en: "Please turn on the meter." },
            { ja: "予約より少し早く着きそうです。", en: "I think I'll arrive a little earlier than my reservation." },
            { ja: "到着が遅れます。", en: "I'm running late." },
            { ja: "眺めの良い部屋をお願いできますか？", en: "Could I have a room with a view?" },
            { ja: "静かな部屋をお願いします。", en: "I'd like a quiet room, please." },
            { ja: "エキストラベッドを追加できますか？", en: "Could we add an extra bed?" },
            { ja: "朝食を部屋に持ってきてもらえますか？", en: "Could I have breakfast in my room?" },
            { ja: "金庫の使い方がわかりません。", en: "I don't know how to use the safe." },
            { ja: "シャワーの水圧が弱いです。", en: "The water pressure in the shower is weak." },
            { ja: "トイレが詰まりました。", en: "The toilet is clogged." },
            { ja: "部屋が掃除されていません。", en: "My room hasn't been cleaned." },
            { ja: "チェックアウトを1時間延長できますか？", en: "Could I extend my check-out by an hour?" },
            { ja: "荷物を夕方まで預かってもらえますか？", en: "Could you keep my bags until this evening?" },
            { ja: "近くにコンビニはありますか？", en: "Is there a convenience store nearby?" },
            { ja: "おすすめの地元料理のレストランはありますか？", en: "Are there any restaurants that serve local food?" },
            { ja: "予約をキャンセルしたいのですが。", en: "I'd like to cancel my reservation." },
            { ja: "テラス席は空いていますか？", en: "Is there a table available on the terrace?" },
            { ja: "子供用のメニューはありますか？", en: "Do you have a kids' menu?" },
            { ja: "料理が出てくるのが遅いです。", en: "The food is coming out very slowly." },
            { ja: "注文したものがまだ来ません。", en: "My order hasn't arrived yet." },
            { ja: "これは注文していません。", en: "I didn't order this." },
            { ja: "お会計が間違っているようです。", en: "I think there is a mistake on the bill." },
            { ja: "この料理には何が入っていますか？", en: "What are the ingredients in this dish?" },
            { ja: "パクチーを抜いてもらえますか？", en: "Could you leave out the coriander?" },
            { ja: "ドレッシングを別添えにできますか？", en: "Could I have the dressing on the side?" },
            { ja: "辛さを控えめにしてもらえますか？", en: "Could you make it less spicy?" },
            { ja: "お水をもう一杯いただけますか？", en: "Could I have another glass of water?" },
            { ja: "取り皿を何枚かいただけますか？", en: "Could we have some small plates to share?" },
            { ja: "残った料理を持ち帰れますか？", en: "Can I take the leftovers home?" },
            { ja: "クレジットカードの暗証番号を忘れました。", en: "I forgot my credit card PIN." },
            { ja: "現金でお釣りをもらえますか？", en: "Can I get the change in cash?" },
            { ja: "チップは含まれていますか？", en: "Is the tip included?" },
            { ja: "割り勘にしてもらえますか？", en: "Could we split the bill?" },
            { ja: "このカードは使えませんでした。", en: "This card didn't work." },
            { ja: "一日乗車券はありますか？", en: "Do you have a one-day pass?" },
            { ja: "路線図をもらえますか？", en: "Could I have a route map?" },
            { ja: "次の電車は何時ですか？", en: "What time is the next train?" },
            { ja: "終電は何時ですか？", en: "What time is the last train?" },
            { ja: "このチケットは払い戻しできますか？", en: "Is this ticket refundable?" },
            { ja: "乗り越してしまいました。", en: "I missed my stop." },
            { ja: "反対方向の電車に乗ってしまいました。", en: "I took the train in the wrong direction." },
            { ja: "このバス停には止まりますか？", en: "Does it stop at this bus stop?" },
            { ja: "博物館への行き方を教えてください。", en: "Could you tell me how to get to the museum?" },
            { ja: "歩いてどのくらいかかりますか？", en: "How long does it take on foot?" },
            { ja: "地図で場所を指してもらえますか？", en: "Could you point it out on the map?" },
            { ja: "この辺りで一番有名な観光地はどこですか？", en: "What is the most famous sightseeing spot around here?" },
            { ja: "入場制限はありますか？", en: "Is there an entry limit?" },
            { ja: "再入場はできますか？", en: "Can I re-enter?" },
            { ja: "音声ガイドはありますか？", en: "Do you have an audio guide?" },
            { ja: "ロッカーはどこにありますか？", en: "Where are the lockers?" },
            { ja: "ベビーカーを借りることはできますか？", en: "Can I rent a stroller?" },
            { ja: "ここで飲食してもいいですか？", en: "Is eating and drinking allowed here?" },
            { ja: "列に並んでいますか？", en: "Are you in line?" },
            { ja: "この席を使ってもいいですか？", en: "Do you mind if I use this seat?" },
            { ja: "写真を撮りましょうか？", en: "Shall I take a picture for you?" },
            { ja: "もう一枚撮ってもらえますか？", en: "Could you take one more, please?" },
            { ja: "縦向きで撮ってください。", en: "Please take it vertically." },
            { ja: "横向きで撮ってください。", en: "Please take it horizontally." },
            { ja: "Wi-Fiが繋がりません。", en: "The Wi-Fi isn't connecting." },
            { ja: "充電器を貸してもらえますか？", en: "Could I borrow a charger?" },
            { ja: "コンセントを使ってもいいですか？", en: "May I use the outlet?" },
            { ja: "SIMカードを入れ替えたいのですが。", en: "I'd like to switch my SIM card." },
            { ja: "データ通信が動きません。", en: "My data isn't working." },
            { ja: "近くに薬局はありますか？", en: "Is there a pharmacy nearby?" },
            { ja: "頭痛薬が欲しいのですが。", en: "I'd like some headache medicine." },
            { ja: "風邪をひいたみたいです。", en: "I think I caught a cold." },
            { ja: "日焼け止めはありますか？", en: "Do you have sunscreen?" },
            { ja: "絆創膏を持っていますか？", en: "Do you have a band-aid?" },
            { ja: "虫除けスプレーはありますか？", en: "Do you have insect repellent?" },
            { ja: "救急車を呼んでください！", en: "Please call an ambulance!" },
            { ja: "警察署はどこですか？", en: "Where is the police station?" },
            { ja: "盗難届を出したいのですが。", en: "I'd like to report a theft." },
            { ja: "落とし物をしました。", en: "I lost something." },
            { ja: "これが私の連絡先です。", en: "This is my contact information." },
            { ja: "もし見つかったら連絡してください。", en: "Please contact me if it's found." },
            { ja: "少し安くしてくれませんか？", en: "Could you give me a little discount?" },
            { ja: "2つ買ったら安くなりますか？", en: "Is it cheaper if I buy two?" },
            { ja: "予算オーバーです。", en: "It's over my budget." },
            { ja: "他のお店も見てみます。", en: "I'll look around other shops." },
            { ja: "新しい在庫はありますか？", en: "Do you have a new one in stock?" },
            { ja: "試着室はどこですか？", en: "Where is the fitting room?" },
            { ja: "サイズが合いません。", en: "The size doesn't fit." },
            { ja: "ズボンの裾上げはできますか？", en: "Can you hem these pants?" },
            { ja: "配送してもらえますか？", en: "Can you ship this?" },
            { ja: "日本に送れますか？", en: "Can you ship this to Japan?" },
            { ja: "返品はできますか？", en: "Can I return this?" },
            { ja: "交換はできますか？", en: "Can I exchange this?" },
            { ja: "レシートをなくしてしまいました。", en: "I lost the receipt." },
            { ja: "これはギフト用です。", en: "This is a gift." },
            { ja: "個別に包んでもらえますか？", en: "Could you wrap them separately?" },
            { ja: "地元の名産品は何ですか？", en: "What is the local specialty?" },
            { ja: "賞味期限はいつですか？", en: "When is the expiration date?" },
            { ja: "常温で保存できますか？", en: "Can I store this at room temperature?" },
            { ja: "おすすめのお土産はありますか？", en: "Do you have any recommendations for souvenirs?" },
            { ja: "ここでしか買えないものはありますか？", en: "Is there anything I can only buy here?" },
            { ja: "写真をSNSに載せてもいいですか？", en: "Can I post this photo on social media?" },
            { ja: "アカウントを教えてもらえますか？", en: "Could you tell me your account?" },
            { ja: "タグ付けしてもいいですか？", en: "Can I tag you?" },
            { ja: "この景色は素晴らしいですね。", en: "This view is amazing." },
            { ja: "雰囲気がとても良いですね。", en: "The atmosphere is very nice." },
            { ja: "あなたの服、素敵ですね。", en: "I like your outfit." },
            { ja: "親切にしてくれてありがとう。", en: "Thank you for being so kind." },
            { ja: "あなたのおかげで助かりました。", en: "You saved me." },
            { ja: "またここに来たいです。", en: "I want to come here again." },
            { ja: "日本に来たことはありますか？", en: "Have you ever been to Japan?" },
            { ja: "日本食は好きですか？", en: "Do you like Japanese food?" },
            { ja: "おすすめの日本の場所を教えましょうか？", en: "Shall I tell you some recommended places in Japan?" },
            { ja: "お名前を伺ってもいいですか？", en: "May I ask your name?" },
            { ja: "どのくらいここに住んでいますか？", en: "How long have you lived here?" },
            { ja: "週末は何をしていますか？", en: "What do you do on weekends?" },
            { ja: "何かおすすめの音楽はありますか？", en: "Do you have any music recommendations?" },
            { ja: "これはどういう意味ですか？", en: "What does this mean?" },
            { ja: "発音を教えてもらえますか？", en: "Could you tell me the pronunciation?" },
            { ja: "少し急いでいます。", en: "I'm in a bit of a hurry." },
            { ja: "後でまた来ます。", en: "I'll come back later." },
            { ja: "気にしないでください。", en: "Never mind." },
            { ja: "それは知りませんでした。", en: "I didn't know that." },
            { ja: "なるほど。", en: "That makes sense." },
            { ja: "その通りです。", en: "Exactly." },
            { ja: "どう思いますか？", en: "What do you think?" },
            { ja: "私もそう思います。", en: "I think so too." },
            { ja: "私はそう思いません。", en: "I don't think so." },
            { ja: "お先にどうぞ。", en: "After you." },
            { ja: "気をつけて帰ってください。", en: "Get home safely." },
            { ja: "楽しんでください。", en: "Have fun." },
            { ja: "準備はいいですか？", en: "Are you ready?" },
            { ja: "確認させてください。", en: "Let me check." },
            { ja: "例えばどういうことですか？", en: "For example?" },
            { ja: "それだけです。", en: "That's all." },
            { ja: "ところで。", en: "By the way." },
            { ja: "今のところ順調です。", en: "So far so good." },
            { ja: "運が悪かったです。", en: "It was bad luck." },
            { ja: "それはラッキーでしたね。", en: "That was lucky." },
            { ja: "信じられません。", en: "I can't believe it." },
            { ja: "驚きました。", en: "I'm surprised." },
            { ja: "緊張しています。", en: "I'm nervous." },
            { ja: "興奮しています。", en: "I'm excited." },
            { ja: "がっかりしました。", en: "I'm disappointed." },
            { ja: "疲れました。", en: "I'm tired." },
            { ja: "眠いです。", en: "I'm sleepy." },
            { ja: "お腹が空きました。", en: "I'm hungry." },
            { ja: "喉が渇きました。", en: "I'm thirsty." },
            { ja: "お手洗いを借りてもいいですか？", en: "May I use the restroom?" },
            { ja: "手を洗いたいのですが。", en: "I'd like to wash my hands." },
            { ja: "ティッシュを持っていますか？", en: "Do you have a tissue?" },
            { ja: "ゴミ箱はどこですか？", en: "Where is the trash can?" },
            { ja: "これはリサイクルできますか？", en: "Can this be recycled?" },
            { ja: "喫煙席はありますか？", en: "Is there a smoking section?" },
            { ja: "灰皿はありますか？", en: "Do you have an ashtray?" },
            { ja: "ここでは靴を脱いでください。", en: "Please take off your shoes here." },
            { ja: "スリッパを履いてください。", en: "Please put on slippers." },
            { ja: "傘を貸してもらえますか？", en: "Could I borrow an umbrella?" },
            { ja: "雨が止みました。", en: "The rain has stopped." },
            { ja: "晴れてきました。", en: "It's clearing up." },
            { ja: "今日は暑くなりそうです。", en: "It's going to be hot today." },
            { ja: "風が強いです。", en: "It's windy." },
            { ja: "湿気が多いです。", en: "It's humid." },
            { ja: "乾燥しています。", en: "It's dry." },
            { ja: "日没は何時ですか？", en: "What time is sunset?" },
            { ja: "日の出は何時ですか？", en: "What time is sunrise?" },
            { ja: "星が綺麗ですね。", en: "The stars are beautiful." },
            { ja: "月が出ています。", en: "The moon is out." },
            { ja: "道に迷ってしまったようです。", en: "I seem to have lost my way." },
            { ja: "この地図で現在地を教えてください。", en: "Please show me where we are on this map." },
            { ja: "北はどっちですか？", en: "Which way is north?" },
            { ja: "反対方向ですか？", en: "Is it the opposite direction?" },
            { ja: "この道をまっすぐですか？", en: "Is it straight down this road?" },
            { ja: "信号を渡ってください。", en: "Cross at the traffic light." },
            { ja: "橋を渡ってください。", en: "Cross the bridge." },
            { ja: "トンネルを抜けてください。", en: "Go through the tunnel." },
            { ja: "階段を上がってください。", en: "Go up the stairs." },
            { ja: "エレベーターを使ってください。", en: "Use the elevator." },
            { ja: "突き当たりを右です。", en: "Turn right at the end of the street." },
            { ja: "銀行の隣です。", en: "It's next to the bank." },
            { ja: "ホテルの向かいです。", en: "It's across from the hotel." },
            { ja: "駅の近くです。", en: "It's near the station." },
            { ja: "徒歩5分くらいです。", en: "It's about a 5-minute walk." },
            { ja: "車で10分くらいです。", en: "It's about a 10-minute drive." },
            { ja: "遠すぎます。", en: "It's too far." },
            { ja: "タクシーを使った方がいいですよ。", en: "You should take a taxi." },
            { ja: "バスの方が安いです。", en: "The bus is cheaper." }
        ];

        // --- App State ---
        let currentPart = localStorage.getItem('currentPart') || 'part1';
        let phrases = [];
        let currentIndex = 0;
        let isPlaying = false;
        let wakeLock = null;

        // --- Init & Load ---
        function loadPhrases(part) {
            currentPart = part;
            localStorage.setItem('currentPart', currentPart);
            
            // UI Update
            document.getElementById('partSelector').value = currentPart;
            document.getElementById('courseNameDisplay').innerText = (currentPart === 'part1') ? 'Part 1' : 'Part 2';
            
            // Raw data selection
            const rawData = (currentPart === 'part1') ? rawPhrasesPart1 : rawPhrasesPart2;
            
            // Reset to raw data (since we don't track progress anymore)
            phrases = rawData.map((p, i) => ({ ...p, id: i }));
            
            stopLearning();
            currentIndex = 0;
            updateStats();
            updateUI(phrases[0]);
        }

        function changePart() {
            const val = document.getElementById('partSelector').value;
            loadPhrases(val);
        }

        // --- Core Functions ---

        async function togglePlay() {
            const btn = document.getElementById('toggleBtn');
            if (isPlaying) {
                stopLearning();
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>再生スタート';
                btn.classList.replace('bg-red-600', 'bg-blue-600');
                btn.classList.replace('hover:bg-red-500', 'hover:bg-blue-500');
            } else {
                await requestWakeLock();
                startLearning();
                btn.innerHTML = '<i class="fas fa-stop mr-2"></i>停止';
                btn.classList.replace('bg-blue-600', 'bg-red-600');
                btn.classList.replace('hover:bg-blue-500', 'hover:bg-red-500');
            }
        }

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    document.getElementById('wakeLockStatus').classList.replace('wake-lock-inactive', 'wake-lock-active');
                    document.getElementById('wakeLockStatus').innerHTML = '<i class="fas fa-lightbulb mr-1"></i>画面維持: ON';
                }
            } catch (err) {
                console.log(`Wake Lock Error: ${err.name}, ${err.message}`);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release()
                    .then(() => {
                        wakeLock = null;
                        document.getElementById('wakeLockStatus').classList.replace('wake-lock-active', 'wake-lock-inactive');
                        document.getElementById('wakeLockStatus').innerHTML = '<i class="fas fa-lightbulb mr-1"></i>画面維持: OFF';
                    });
            }
        }

        function toggleCurtain(show) {
            const curtain = document.getElementById('curtain');
            if (show) {
                curtain.classList.remove('hidden');
                requestWakeLock();
            } else {
                curtain.classList.add('hidden');
            }
        }

        function startLearning() {
            isPlaying = true;
            playLoop();
        }

        function stopLearning() {
            isPlaying = false;
            window.speechSynthesis.cancel();
            releaseWakeLock();
        }

        async function playLoop() {
            if (!isPlaying) return;
            if (currentIndex >= phrases.length) {
                currentIndex = 0; 
            }

            const currentPhrase = phrases[currentIndex];
            updateUI(currentPhrase);
            updateStats();

            // 1. Japanese
            await speak(currentPhrase.ja, 'ja-JP');
            if (!isPlaying) return;

            // 2. Wait 2s
            await new Promise(r => setTimeout(r, 2000));
            if (!isPlaying) return;

            // 3. English
            revealEnglish();
            await speak(currentPhrase.en, 'en-US');
            if (!isPlaying) return;

            // 4. Wait 2s
            await new Promise(r => setTimeout(r, 2000));
            if (!isPlaying) return;

            // 5. Next
            currentIndex++;
            playLoop();
        }

        // Improved Speak Function for better quality
        function speak(text, lang, rate = 1.0) {
            return new Promise((resolve) => {
                const uttr = new SpeechSynthesisUtterance(text);
                uttr.lang = lang;
                uttr.rate = rate; // Speed
                
                // Audio Quality Improvement: Try to find Google voices
                const voices = window.speechSynthesis.getVoices();
                // 1. Try to find "Google" + correct lang (High Quality usually)
                let voice = voices.find(v => v.name.includes('Google') && v.lang.includes(lang.replace('_', '-')));
                
                // 2. Fallback to any voice with correct lang
                if (!voice) {
                     voice = voices.find(v => v.lang.includes(lang.replace('_', '-')));
                }
                
                if(voice) {
                    uttr.voice = voice;
                    // console.log("Using voice:", voice.name);
                }

                uttr.onend = resolve;
                uttr.onerror = resolve; 
                window.speechSynthesis.speak(uttr);
            });
        }

        function skip(direction) {
            stopLearning();
            document.getElementById('toggleBtn').innerHTML = '<i class="fas fa-play mr-2"></i>再生スタート';
            document.getElementById('toggleBtn').classList.replace('bg-red-600', 'bg-blue-600');
            document.getElementById('toggleBtn').classList.replace('hover:bg-red-500', 'hover:bg-blue-500');

            currentIndex += direction;
            if (currentIndex < 0) currentIndex = phrases.length - 1;
            if (currentIndex >= phrases.length) currentIndex = 0;
            
            updateUI(phrases[currentIndex]);
            updateStats();
        }

        function updateUI(phrase) {
            if(!phrase) return;
            document.getElementById('japaneseText').innerText = phrase.ja;
            document.getElementById('englishText').innerText = phrase.en;
            document.getElementById('englishArea').classList.remove('opacity-100');
            document.getElementById('englishArea').classList.add('opacity-0');
        }

        function revealEnglish() {
            document.getElementById('englishArea').classList.remove('opacity-0');
            document.getElementById('englishArea').classList.add('opacity-100');
        }

        function updateStats() {
            document.getElementById('currentIndex').innerText = currentIndex + 1;
            document.getElementById('totalCount').innerText = phrases.length;
            const pct = ((currentIndex) / phrases.length) * 100;
            document.getElementById('progressBar').style.width = `${pct}%`;
        }

        // --- Init ---
        // Ensure voices are loaded
        window.speechSynthesis.getVoices();
        window.speechSynthesis.onvoiceschanged = () => {
            window.speechSynthesis.getVoices();
        };

        // Initialize with saved part or default
        loadPhrases(currentPart);

    </script>
</body>
</html>
